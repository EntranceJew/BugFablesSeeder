<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.css" integrity="sha256-46qynGAkLSFpVbEBog43gvNhfrOj+BmwXdxFgVK/Kvc=" crossorigin="anonymous" />
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/vue-select.css" />
    <link rel="stylesheet" href="css/main.css" />

    <title>Bug Fable Seeder</title>
</head>
<body class="bg-light">
<div id="bug-save-app">
<main role="main" class="container">
    <div class="row">
        <div class="col col-3">
            <div id="drop_zone" class="text-center" v-on:drop="dropHandler" v-on:dragover="dragOverHandler">
                <p>[drop Bug Fables saveN.dat here]</p>
            </div>
        </div>
        <div class="col col-3">
            <div class="custom-control custom-checkbox checkbox-lg">
                <input type="checkbox" class="custom-control-input" id="spoilers" v-model="spoilers">
                <label class="custom-control-label" for="spoilers">Spoilers?</label>
            </div>
            <br/>
            <div class="btn-group" role="group" aria-label="Basic example">
                <button type="button" class="btn btn-secondary" @click="save">
                    <i class="fas fa-file-download"></i> Save
                </button>
                <button type="button" class="btn btn-secondary" @click="reset">
                    <i class="fas fa-toilet-paper"></i> Reset
                </button>
            </div>
        </div>
        <div class="col col-3">
            <div class="row h-100">
                <div class="col-sm-12 my-auto">
                    <img class="img-fluid" src="images/logo.png"/>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="card col col-12">
            <div class="card-body">
                <form class="needs-validation">
                    <div class="form-row">
                        <div class="form-group col-md-1">
                            <img src="images/ui/menu/records.png" />
                        </div>
                        <div class="form-group col-md-11">
                            <h2 class="mb-3 title-name">
                                Save Info
                            </h2>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-1">
                            <img class="icon-offset" src="images/ui/menu/settings.png" />
                        </div>
                        <div class="form-group col-3">
                            <label>File Name</label>
                            <input type="text" class="form-control" v-model="file_name"/>
                        </div>
                        <div class="form-group col-3">
                            <label>Player Name</label>
                            <input type="text" class="form-control" v-model="bug_save.profile_name"/>
                        </div>
                        <div class="form-group col-3">
                            <label>Seed</label>
                            <div class="input-group">
                                <input type="text" class="form-control" v-model="seed">
                                <div class="input-group-append" @click="reseed()">
                                    <span class="input-group-text"><i class="fas fa-redo"></i></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-1">
                            <img class="icon-offset" src="images/ui/money.png" />
                        </div>
                        <div class="form-group col-3">
                            <label>Berries (Wallet)</label>
                            <input type="number" class="form-control" v-model="bug_save.party_stats.money"/>
                        </div>
                        <div class="form-group col-3">
                            <label>Berries (Bank)</label>
                            <input type="number" class="form-control" v-model="bug_save.flag_variables[26]"/>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-1">
                            <img class="icon-offset" src="images/ui/token.png" />
                        </div>
                        <div class="form-group col-3">
                            <label>Game Tokens</label>
                            <input type="number" class="form-control" v-model="bug_save.flag_variables[27]"/>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-1">
                            <img class="icon-offset" src="images/ui/menu/inventory.png" />
                        </div>
                        <div class="form-group col-3">
                            <label>Max Items</label>
                            <input type="number" class="form-control" v-model="bug_save.party_stats.maxitems"/>
                        </div>
                        <div class="form-group col-3">
                            <label>Max Storage</label>
                            <input type="number" class="form-control" v-model="bug_save.party_stats.maxstorage"/>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-1">
                            <img class="icon-offset" src="images/ui/time.png" />
                        </div>
                        <div class="form-group col-3">
                            <label>Hours</label>
                            <input type="number" class="form-control" v-model="bug_save.party_stats.clockhour"/>
                        </div>
                        <div class="form-group col-3">
                            <label>Minutes</label>
                            <input type="number" class="form-control" v-model="bug_save.party_stats.clockmin"/>
                        </div>
                        <div class="form-group col-3">
                            <label>Seconds</label>
                            <input type="number" class="form-control" v-model="bug_save.party_stats.clocksec"/>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-1">
                            <img class="icon-offset" src="images/ui/location.png" />
                        </div>
                        <div class="form-group col-2">
                            <label>X</label>
                            <input type="number" class="form-control" v-model="bug_save.position.x"/>
                        </div>
                        <div class="form-group col-2">
                            <label>Y</label>
                            <input type="number" class="form-control" v-model="bug_save.position.y"/>
                        </div>
                        <div class="form-group col-2">
                            <label>Z</label>
                            <input type="number" class="form-control" v-model="bug_save.position.z"/>
                        </div>
                        <div class="form-group col-2">
                            <label>Map</label>
                            <input type="number" class="form-control" v-model="bug_save.party_stats.map_name"/>
                        </div>
                        <div class="form-group col-2">
                            <label>Area</label>
                            <input type="number" class="form-control" v-model="bug_save.party_stats.areaid"/>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-1">
                            <img class="icon-offset" src="images/ui/mystery.png" />
                        </div>
                        <div class="form-group col-11">
                            <draggable @start="hideTips" class="medal-zone" v-model="bug_save.mystery_medals" group="medals" >
                                <bug-medal v-for="medal in bug_save.mystery_medals"
                                           :medal="medal">
                                </bug-medal>
                            </draggable>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="row" v-for="(shop, index) in bug_save.badge_shops">
        <div class="card col col-12">
            <div class="card-body">
                <form>
                    <div class="form-row">
                        <div class="form-group col-md-1">
                            <img :src="'images/shops/'+index+'.png'" />
                        </div>
                        <div class="form-group col-md-11">
                            <h2 class="mb-3 title-name">
                                {{ game_data.shop_names[index] }}'s Shop
                            </h2>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-1">
                            <img class="icon-offset" src="images/ui/medal.png" />
                        </div>
                        <div class="form-group col-11">
                            <draggable @start="hideTips" class="medal-zone" v-model="bug_save.badge_shops[index]" group="medals" >
                                <bug-medal v-for="medal in bug_save.badge_shops[index]"
                                           :medal="medal">
                                </bug-medal>
                            </draggable>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="card col col-12">
            <div class="card-body">
                <form>
                    <div class="form-row">
                        <div class="form-group col-md-1">
                            <img src="images/ui/party.png" />
                        </div>
                        <div class="form-group col-md-11">
                            <h2 class="mb-3 title-name">
                                Party
                            </h2>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-1">
                            <img class="icon-offset" src="images/ui/exp.png" />
                        </div>
                        <div class="form-group col-md-2">
                            <label>Level</label>
                            <input type="number" class="form-control" v-model="bug_save.party_stats.partylevel">
                        </div>
                        <div class="form-group col-md-2">
                            <label>Exp</label>
                            <input type="number" class="form-control" v-model="bug_save.party_stats.partyexp">
                        </div>
                        <div class="form-group col-md-2">
                            <label>Needed Exp</label>
                            <input type="number" class="form-control" v-model="bug_save.party_stats.neededexp">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-1">
                            <img class="icon-offset" src="images/ui/tp.png" />
                        </div>
                        <div class="form-group col-md-2">
                            <label>TP</label>
                            <input type="number" class="form-control" v-model="bug_save.party_stats.tp">
                        </div>
                        <div class="form-group col-md-2">
                            <label>Base TP</label>
                            <input type="number" class="form-control" v-model="bug_save.party_stats.basetp">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-1">
                            <img class="icon-offset" src="images/ui/medal.png" />
                        </div>
                        <div class="form-group col-md-2">
                            <label>MP</label>
                            <input type="number" class="form-control" v-model="bug_save.party_stats.bp">
                        </div>
                        <div class="form-group col-md-2">
                            <label>Max MP</label>
                            <input type="number" class="form-control" v-model="bug_save.party_stats.maxbp">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-1">
                            <img class="icon-offset" src="images/ui/mystery.png" />
                        </div>
                        <div class="form-group col-md-11">
                            <draggable @start="hideTips" class="col col-12 medal-zone" v-model="bug_save.medals_inventory" group="medals" >
                                <bug-medal v-for="medal in bug_save.medals_inventory"
                                           :medal="medal">
                                </bug-medal>
                            </draggable>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-1">
                            <img class="icon-offset" src="images/ui/medal.png" />
                        </div>
                        <div class="form-group col-md-11">
                            <draggable @start="hideTips" class="col col-12 medal-zone" v-model="bug_save.medals_party" group="medals" >
                                <bug-medal v-for="medal in bug_save.medals_party"
                                           :medal="medal">
                                </bug-medal>
                            </draggable>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-1">
                            <img class="icon-offset" src="images/ui/stats.png" />
                        </div>
                        <div class="form-group col-md-11">
                            <draggable @start="hideTips" class="col col-12 medal-zone" v-model="bug_save.party_stat_bonuses" group="statbonus" >
                                <bug-bonus v-for="statbonus in bug_save.party_stat_bonuses"
                                           :statbonus="statbonus">
                                </bug-bonus>
                            </draggable>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-1">
                            <img class="icon-offset" src="images/ui/menu/items.png" />
                        </div>
                        <div class="form-group col-md-11">
                            <draggable @start="hideTips" class="col col-12 medal-zone" v-model="bug_save.inventory[0]" group="items" >
                                <bug-item v-for="item in bug_save.inventory[0]"
                                           :item="item">
                                </bug-item>
                            </draggable>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-1">
                            <img class="icon-offset" src="images/ui/menu/key_items.png" />
                        </div>
                        <div class="form-group col-md-11">
                            <draggable @start="hideTips" class="col col-12 medal-zone" v-model="bug_save.inventory[1]" group="items" >
                                <bug-item v-for="item in bug_save.inventory[1]"
                                          :item="item">
                                </bug-item>
                            </draggable>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-1">
                            <img class="icon-offset" src="images/ui/menu/bestiary.png" />
                        </div>
                        <div class="form-group col-md-11">
                            <draggable @start="hideTips" class="col col-12 medal-zone" v-model="bug_save.inventory[2]" group="items" >
                                <bug-item v-for="item in bug_save.inventory[2]"
                                          :item="item">
                                </bug-item>
                            </draggable>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="row" v-for="character in bug_save.characters" v-show="character">
        <div class="card col col-12">
            <div class="card-body">
                <form>
                    <div class="form-row">
                        <div class="form-group col-md-1">
                            <img :src="'images/characters/'+character.trueid+'.png'" />
                        </div>
                        <div class="form-group col-md-11">
                            <h2 class="mb-3 title-name">
                                {{ game_data.character_names[character.trueid] }}
                            </h2>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-1">
                            <img class="icon-offset" src="images/ui/atk.png" />
                        </div>
                        <div class="form-group col-md-2">
                            <label>Attack</label>
                            <input type="number" class="form-control" v-model="bug_save.characters[character.id].atk">
                        </div>
                        <div class="form-group col-md-2">
                            <label>Base Attack</label>
                            <input type="number" class="form-control" v-model="bug_save.characters[character.id].baseatvk">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-1">
                            <img class="icon-offset" src="images/ui/def.png" />
                        </div>
                        <div class="form-group col-md-2">
                            <label>Defense</label>
                            <input type="number" class="form-control" v-model="bug_save.characters[character.id].def">
                        </div>
                        <div class="form-group col-md-2">
                            <label>Base Defense</label>
                            <input type="number" class="form-control" v-model="bug_save.characters[character.id].basedef">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-1">
                            <img class="icon-offset" src="images/ui/hp.png" />
                        </div>
                        <div class="form-group col-md-2">
                            <label>HP</label>
                            <input type="number" class="form-control" v-model="bug_save.characters[character.id].hp">
                        </div>
                        <div class="form-group col-md-2">
                            <label>Base HP</label>
                            <input type="number" class="form-control" v-model="bug_save.characters[character.id].basehp">
                        </div>
                        <div class="form-group col-md-2">
                            <label>Max HP</label>
                            <input type="number" class="form-control" v-model="bug_save.characters[character.id].maxhp">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-1">
                            <img class="icon-offset" src="images/ui/medal.png" />
                        </div>
                        <div class="form-group col-md-11">
                            <draggable @start="hideTips" class="col col-12 medal-zone" v-model="bug_save.characters[character.id].medals" group="medals" >
                                <bug-medal v-for="medal in bug_save.characters[character.id].medals"
                                           :medal="medal"
                                           :key="medal.id">
                                </bug-medal>
                            </draggable>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-1">
                            <img class="icon-offset" src="images/ui/stats.png" />
                        </div>
                        <div class="form-group col-md-11">
                            <draggable @start="hideTips" class="col col-12 medal-zone" v-model="bug_save.characters[character.id].stat_bonuses" group="statbonus" >
                                <bug-bonus v-for="statbonus in bug_save.characters[character.id].stat_bonuses"
                                           :statbonus="statbonus">
                                </bug-bonus>
                            </draggable>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</main>
<footer class="footer bg-dark">
    <div class="container">
        <div class="card col col-12">
            <div class="card-body">
                <form>
                    <div class="form-row">
                        <div class="col col-2">
                            <label>Tool</label>
                            <select class="custom-select d-block w-100" v-model="tool_type">
                                <option value="medal">Medal Generator</option>
                                <option value="item">Item Generator</option>
                                <option value="statbonus">Stat Bonus Generator</option>
                            </select>
                        </div>
                        <div class="col col-10" v-show="'medal' == tool_type">
                            <div class="form-row">
                                <div class="col col-3">
                                    <label>Medal:</label>
                                    <select class="custom-select d-block w-100" v-model="badge_generator_selection" @change="generate_badge($event)">
                                        <option v-for="badge in badge_data" v-bind:value="badge.id">
                                            {{ badge.name }}
                                        </option>
                                    </select>
                                </div>
                                <draggable @start="hideTips" class="col col-9 medal-zone" v-model="badge_generator_inventory" group="medals" >
                                    <bug-medal v-for="medal in badge_generator_inventory"
                                               :medal="medal"
                                               :key="medal.id">
                                    </bug-medal>
                                </draggable>
                            </div>
                        </div>
                        <div class="col col-10" v-show="'item' == tool_type">
                            <div class="form-row">
                                <div class="col col-3">
                                    <label>Item</label>
                                    <select class="custom-select d-block w-100" v-model="item_generator_selection" @change="generate_item($event)">
                                        <option v-for="item in item_data" v-bind:value="item.id">
                                            {{ item.name }}
                                        </option>
                                    </select>
                                </div>
                                <draggable @start="hideTips" class="col col-9 medal-zone" v-model="item_generator_inventory" group="items" >
                                    <bug-item v-for="item in item_generator_inventory"
                                               :item="item"
                                               :key="item.id">
                                    </bug-item>
                                </draggable>
                            </div>
                        </div>
                        <div class="col col-10" v-show="'statbonus' == tool_type">
                            <div class="form-row">
                                <div class="col col-3">
                                    <label>Type:</label>
                                    <select class="custom-select d-block w-100" v-model="statbonus_generator_type" @change="generate_statbonus($event)">
                                        <option value="0" selected="selected">HP</option>
                                        <option value="1">Attack</option>
                                        <option value="2">Defense</option>
                                        <option value="3">TP</option>
                                        <option value="4">MP</option>
                                    </select>
                                </div>
                                <div class="col col-2">
                                    <label>Amount:</label>
                                    <input type="number" class="form-control" v-model="statbonus_generator_amount" @change="generate_statbonus($event)"/>
                                </div>
                                <draggable @start="hideTips" class="col col-7 medal-zone" v-model="statbonus_generator_inventory" group="statbonus" >
                                    <bug-bonus v-for="statbonus in statbonus_generator_inventory"
                                              :statbonus="statbonus">
                                    </bug-bonus>
                                </draggable>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</footer>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/js/all.min.js" integrity="sha256-qM7QTJSlvtPSxVRjVWNM2OfTAz/3k5ovHOKmKXuYMO4=" crossorigin="anonymous"></script>
<script src="js/vue.js"></script>
<script src="js/jquery-3.4.1.min.js"></script>
<script src="js/bootstrap.bundle.min.js"></script>
<script src="js/Sortable.min.js"></script>
<script src="js/vuedraggable.umd.min.js"></script>
<script src="js/vue-select.js"></script>
<script src="js/seededshuffle.js"></script>
<script src="js/main.js"></script>
<script type="application/javascript">
    Vue.component('bug-bonus', {
        props: ['statbonus'],
        template: `
        <div class="bug-bonus">
            <a href="#">
                <span class="notify-badge">{{ statbonus.amount }}</span>
                <img :src='"images/ui/"+bonus_icon()+".png"' />
            </a>
        </div>`,
        methods: {
            bonus_icon() {
                switch (this.statbonus.type) {
                    case "0":
                        // hp;
                        return "hp";
                    case "1":
                        // attack
                        return "atk";
                    case "2":
                        // defense
                        return "def";
                    case "3":
                        // TP
                        return "tp";
                    case "4":
                        // MP
                        return "medal";
                }
            },
        }
    });

    Vue.component('bug-medal', {
        props: ['medal'],
        template: `<img
            :src='medal.secret ? "images/ui/mystery.png" : "images/medals/"+medal.medal_id+".png"'
            :alt='"#"+medal.medal_id+" ("+medal.name+")"'
            @click='onClick'
            :data-original-title='getTitle()' data-toggle="tooltip" data-html="true"
        />`,
        methods: {
            onClick () {
                this.medal.secret = !this.medal.secret;
                this.$root.resetTooltips();
            },
            getTitle() {
                return this.medal.secret ? `
                <h5>Mystery Medal</h5>
                <h6>#???</h6>
                <br/>
                <span>Click to reveal real badge.</span>
                ` : `
                <h5>${this.medal.name}</h5>
                <h6>#${this.medal.medal_id}</h6>
                <br/>
                <span>${this.medal.description}</span>
                `;
            }
        }
    });

    Vue.component('bug-item', {
        props: ['item'],
        template: `<img
            :src='"images/items/"+item.item_id+".png"'
            :data-original-title='getTitle()' data-toggle="tooltip" data-html="true"
        />`,
        methods: {
            getTitle() {
                return `
                <h5>${this.item.name}</h5>
                <h6>#${this.item.item_id}</h6>
                <br/>
                <span>${this.item.description}</span>
                `;
            }
        }
    });

    // noinspection JSUnusedGlobalSymbols
    var bugApp = new Vue({
        el: '#bug-save-app',
        components: {
            vuedraggable
        },
        data: {
            seed: new Date().getTime(),
            tooltips: null,
            spoilers: false,
            file_name: 'save2.dat',
            tool_type: 'medal',
            tool_options: [
                'medal',
                'item'
            ],
            game_data: {
                encryption_key: 543,
                mystery_badge_limit: 106,
                character_count: 3,
                medal_shops_count: 2,

                num_flag_strings: 15,
                num_flag_variables: 65,
                num_flags: 700,
                num_regional_flags: 100,
                num_crystal_berries: 50,
                num_enemy_encounters: 256,
                num_library_x: 5,
                num_library_y: 256,
                initial_flags: [15, 30, 31, 32, 613, 681, 691],
                // available pool => shops
                initial_flag_variables: {
                    [0]: 3,
                    [1]: 1,
                    [5]: -1,
                    [10]: 30,
                    [11]: 3,
                    [28]: 9500,
                    [29]: 4500,
                    [37]: 8,
                    [40]: 1,
                    [41]: 6
                },
                initial_enemy_encounters: {
                    [11]: {id: 11, seen_count: 1, kill_count: 0},
                },

                character_names: [
                    'Vi',
                    'Kabbu',
                    'Leif'
                ],
                shop_names: [
                    'Merab',
                    'Shades'
                ],
                stat_bonus_names: [
                    'hp',
                    'atk',
                    'def',
                    'tp',
                    'medal'
                ],
                description_find_replace: {
                    ['|menu,46|']: 'Vi',
                    ['|menu,47|']: 'Kabbu',
                    ['|menu,48|']: 'Leif',
                    ['|pauseline|']: '<span class="pause-line">',
                    ['|unpauseline|']: '</span>',
                    ['|shopline|']: "\n<br/>",
                },
                mystery_medal_distribution: [0,0,0,0,0,0,1,1,1,1,1,2,3,3,4,4,5,6,6,7,7,8,9,9,10,12,12,13,14,15,16,17,18,19,19,20,21,21,22,23,24,25,26,27,28,29,30,31,32,33,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,49,50,50,51,52,53,54,55,56,56,57,58,59,60,61,61,62,62,63,63,64,64,65,65,66,67,68,69,70,71,72,73,74,74,75,76,77,78,79],
            },
            drag_data: {},
            badge_data: {},
            badge_generator_selection: null,
            badge_generator_inventory: [],
            item_data: {},
            item_generator_selection: null,
            item_generator_inventory: [],
            statbonus_generator_type: 0,
            statbonus_generator_amount: 1,
            statbonus_generator_inventory: [],
            bug_save: {
                position: {x: 0, y: 0, z: 0},
                flag_variables: [],
                party_stats: {
                    money: 0,
                },
            },
            proto_bug_save: {
                mystery_medals: [],
                profile_name: "",
                position: {x: -2, y: 0, z: 8.5},
                available_badge_pools: [["0","1","7","12","30"],["19","6","9","43","42"]],
                badge_shops: [],
                modes: {
                    ruigee: "True",
                    hardest: "False",
                    frameone: "False",
                    morefarm: "False",
                    mystery: "False",
                    [5]: "True"
                },
                medals_inventory: [
                    {
                        id: 0,
                        medal_id: 11,
                        secret: false,
                        name: "Hard Mode",
                        description: "Boosts enemy strength, but gives you more EXP and rewards.",
                        type: "the",
                    },
                ],
                medals_party: [],
                flag_strings: [
                    "Hard Mode Medal",
                    "the",
                    "letterprompt,10,-11,-158,8"
                ],
                flag_variables: [],
                flags: [],
                regional_flags: [],
                crystal_berries: [],
                enemy_encounters: [],
                library: [],
                characters: [
                    {
                        id: 0,
                        trueid: 0,
                        exists: true,

                        baseatvk: 2,
                        atk: 2,

                        def: 0,
                        basedef: 0,

                        hp: 7,
                        basehp: 7,
                        maxhp: 7,

                        medals: [],
                        stat_bonuses: []
                    },
                    {
                        id: 1,
                        trueid: 1,
                        exists: true,

                        baseatvk: 2,
                        atk: 2,

                        def: 0,
                        basedef: 0,

                        hp: 9,
                        basehp: 9,
                        maxhp: 9,

                        medals: [],
                        stat_bonuses: []
                    },
                    {
                        id: 2,
                        trueid: 2,
                        exists: false,

                        medals: [],
                        stat_bonuses: []
                    },
                ],
                party_stats: {
                    partylevel: 1,
                    partyexp: 0,
                    neededexp: 100,

                    money: 0,

                    tp: 10,
                    basetp: 10,

                    map_name: 16,
                    areaid: 0,

                    bp: 4,
                    maxbp: 4,

                    maxitems: 10,
                    maxstorage: 35,

                    clockhour: 0,
                    clockmin: 0,
                    clocksec: 0,
                    save_progress_icons: 0,
                },
                inventory: [
                    [],
                    [{
                        id: 0,
                        item_id: 27,
                        name: "Explorer Permit",
                        short_description: "[error: bad find/replace]",
                        description: "Permit that shows you are a certified exploration team under the Ant Kingdom.",
                        type: "the"
                    }],
                    []
                ],
                party_stat_bonuses: [],
                extra_followers: [""],
                music: [
                    {id: 0, song_id: 4, bought: false},
                    {id: 1, song_id: 1, bought: false},
                    {id: 2, song_id: 5, bought: false}
                ],
                side_quests: [["0"],["11","0"],["0"]]
            }
        },
        mounted: function(){
            let that = this;
            SeededShuffle.setSeed(this.seed);
            this.$nextTick(function () {
                // Code that will run only after the
                // entire view has been rendered
                this.resetTooltips();
                $.get( "resources/Items-resources.assets-2480.txt", function( data ) {
                    // console.log(data);
                }).done(function(data){
                    that.item_data = {};
                    let lines = data.split("\n");
                    for(let i = 0; i < lines.length; i++){
                        if(lines[i]){
                            let item_info = lines[i].split("@");
                            that.item_data[i] = {
                                id: i,
                                name: item_info[0],
                                short_description: item_info[1] ? that.replaceBulk(item_info[1], Object.keys(that.game_data.description_find_replace), Object.values(that.game_data.description_find_replace)) : '[error: bad find/replace]',
                                description: item_info[2] ? that.replaceBulk(item_info[2], Object.keys(that.game_data.description_find_replace), Object.values(that.game_data.description_find_replace)) : '[error: bad find/replace]',
                                type: item_info[3],
                            };
                        }
                    }
                    $.get( "resources/BadgeName-resources.assets-2134.txt", function( data ) {
                        // console.log(data);
                    }).done(function(data){
                        that.badge_data = {};
                        let lines = data.split("\n");
                        for(let i = 0; i < lines.length; i++){
                            if(lines[i]){
                                let badge_info = lines[i].split("@");
                                that.badge_data[i] = {
                                    id: i,
                                    name: badge_info[0],
                                    description: badge_info[1] ? that.replaceBulk(badge_info[1], Object.keys(that.game_data.description_find_replace), Object.values(that.game_data.description_find_replace)) : '[error: bad find/replace]',
                                    type: badge_info[2],
                                };
                            }
                        }
                        that.fill_prototype();
                        that.reset();
                    });
                });
            });
        },
        methods: {
            reverseMessage: function () {
                this.message = this.message.split('').reverse().join('')
            },
            resetTooltips () {
                if(null === this.tooltips){
                    this.tooltips = $('body').tooltip({
                        selector: '[data-toggle="tooltip"]',
                    });
                } else {
                    $(this.tooltips).tooltip('toggle');
                    $(this.tooltips).tooltip('toggle');
                }
            },
            hideTips () {
                $(this.tooltips).tooltip('hide');
            },
            generate_from_seed () {
                SeededShuffle.setSeed(this.seed);
                let new_order = SeededShuffle.shuffle(this.game_data.mystery_medal_distribution, this.seed, true);
                this.bug_save.mystery_medals = [];
                for (let i = 0; i < new_order.length; i++) {
                    this.bug_save.mystery_medals.push(this.medalFromId(new_order[i], i));
                }
            },
            replaceBulk ( str, findArray, replaceArray ){
                let i, regex = [], map = {};
                for( i=0; i<findArray.length; i++ ){
                    regex.push( findArray[i].replace(/([-[\]{}()*+?.\\^$|#,])/g,'\\$1') );
                    map[findArray[i]] = replaceArray[i];
                }
                regex = regex.join('|');
                str = str.replace( new RegExp( regex, 'g' ), function(matched){
                    return map[matched];
                });
                return str;
            },
            encode_utf16: function (s, littleEndian) {
                let a = new Uint8Array(s.length * 2), view = new DataView(a.buffer);
                s.split('').forEach(function(c, i) {
                    view.setUint16(i * 2, c.charCodeAt(0), littleEndian);
                });
                return a;
            },
            /**
             * @return {string}
             */
            Encrypt: function (input) {
                let text = "";
                for (let i = 0; i < input.length; i++){
                    text += String.fromCharCode(input.charCodeAt(i) ^ this.game_data.encryption_key);
                }
                return new TextDecoder("utf-16").decode(this.encode_utf16(text, true));
            },
            dragOverHandler: function (ev) {
                // Prevent default behavior (Prevent file from being opened)
                ev.preventDefault();
            },
            generate_badge: function (ev) {
                ev.preventDefault();
                if(this.badge_generator_selection || this.badge_generator_selection == 0){
                    // noinspection JSUnusedGlobalSymbols
                    this.badge_generator_inventory = [this.medalFromId(this.badge_generator_selection, 0, false)];
                } else {
                    // noinspection JSUnusedGlobalSymbols
                    this.badge_generator_inventory = [];
                }
                this.resetTooltips();
            },
            generate_item: function (ev) {
                ev.preventDefault();
                if(this.item_generator_selection || this.item_generator_selection == 0){
                    // noinspection JSUnusedGlobalSymbols
                    this.item_generator_inventory = [this.itemFromId(this.item_generator_selection, 0, false)];
                } else {
                    // noinspection JSUnusedGlobalSymbols
                    this.item_generator_inventory = [];
                }
                this.resetTooltips();
            },
            generate_statbonus: function (ev) {
                if(this.statbonus_generator_type && this.statbonus_generator_amount){
                    // noinspection JSUnusedGlobalSymbols
                    this.statbonus_generator_inventory = [{amount: this.statbonus_generator_amount, type: this.statbonus_generator_type}];
                } else {
                    // noinspection JSUnusedGlobalSymbols
                    this.statbonus_generator_inventory = [];
                }
                this.resetTooltips();
            },
            /**
             * @return {boolean}
             */
            stringToBoolean (str) {
                if(str === 'True'){
                    return true;
                } else if(str === 'False'){
                    return false;
                }
            },
            /**
             * @return {string}
             */
            booleanToString (b) {
                if(b === true){
                    return 'True';
                } else if(b === false){
                    return 'False';
                }
            },
            saveAndDownload(data, filename, type) {
                let file = new Blob([data], {type: type});
                if (window.navigator.msSaveOrOpenBlob) // IE10+
                    window.navigator.msSaveOrOpenBlob(file, filename);
                else { // Others
                    let a = document.createElement("a"),
                        url = URL.createObjectURL(file);
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    setTimeout(function() {
                        document.body.removeChild(a);
                        window.URL.revokeObjectURL(url);
                    }, 0);
                }
            },
            parseBugFile (text) {
                let bugSave = {
                    // array of booleans, save line 12
                    flags: [],
                    // array of strings, save line 13
                    flag_strings: [],

                    medals_party: [],
                    medals_inventory: [],
                    party_stat_bonuses: []
                };
                let lines = text.split("\n");

                // save file, line 1; position, mode icons, file name
                let splitbuffer = lines[0].split(",", 10);
                let chunkbuffer = [];
                let convertbuffer = [];

                bugSave.position = {
                    x: splitbuffer[0],
                    y: splitbuffer[1],
                    z: splitbuffer[2]
                };
                bugSave.modes = {
                    ruigee: splitbuffer[3],
                    hardest: splitbuffer[4],
                    frameone: splitbuffer[5],
                    morefarm: splitbuffer[6],
                    mystery: splitbuffer[7],
                    [5]: splitbuffer[8],
                };
                bugSave.profile_name = splitbuffer[9];

                // save file, line 2; character stats
                chunkbuffer = lines[1].split("@");
                bugSave.characters = [];
                for (let i = 0; i < this.game_data.character_count; i++) {
                    bugSave.characters[i] = {
                        trueid: i,
                        exists: false,
                        medals: [],
                        stat_bonuses: [],
                    }
                }
                for (let i = 0; i < chunkbuffer.length; i++) {
                    splitbuffer = chunkbuffer[i].split(",");
                    let character_id = parseInt(splitbuffer[0], 10);
                    bugSave.characters[character_id]['id'] = i;
                    bugSave.characters[character_id]['exists'] = true;
                    bugSave.characters[character_id]['trueid'] = character_id;
                    bugSave.characters[character_id]['hp'] = splitbuffer[1];
                    bugSave.characters[character_id]['maxhp'] = splitbuffer[2];
                    bugSave.characters[character_id]['basehp'] = splitbuffer[3];
                    bugSave.characters[character_id]['atk'] = splitbuffer[4];
                    bugSave.characters[character_id]['baseatvk'] = splitbuffer[5];
                    bugSave.characters[character_id]['def'] = splitbuffer[6];
                    bugSave.characters[character_id]['basedef'] =splitbuffer[7];
                }

                // save file, line 3; party stats
                splitbuffer = lines[2].split(",");
                bugSave.party_stats = {
                    partylevel: splitbuffer[0],
                    partyexp: splitbuffer[1],
                    neededexp: splitbuffer[2],
                    basetp: splitbuffer[3],
                    tp: splitbuffer[4],
                    money: parseInt(splitbuffer[5],10),
                    map_name: splitbuffer[6],
                    areaid: splitbuffer[7],
                    bp: splitbuffer[8],
                    maxbp: splitbuffer[9],
                    maxitems: splitbuffer[10],
                    maxstorage: splitbuffer[11],
                    clockhour: splitbuffer[12],
                    clockmin: splitbuffer[13],
                    clocksec: splitbuffer[14],
                    save_progress_icons: splitbuffer[15],
                };

                // save file, line 4; available badges
                chunkbuffer = lines[3].split("@");
                bugSave.available_badge_pools = [];
                for (let i = 0; i < chunkbuffer.length; i++) {
                    bugSave.available_badge_pools.push(chunkbuffer[i].split(","));
                }

                // save file, line 5; badge shops
                chunkbuffer = lines[4].split("@");
                bugSave.badge_shops = [];
                for (let i = 0; i < this.game_data.medal_shops_count; i++) {
                    bugSave.badge_shops[i] = [];
                }
                for (let i = 0; i < chunkbuffer.length; i++) {
                    bugSave.badge_shops[i] = [];
                    splitbuffer = chunkbuffer[i].split(",");
                    for (let j = 0; j < splitbuffer.length; j++) {
                        if(splitbuffer[j]){
                            bugSave.badge_shops[i].push(this.medalFromId(splitbuffer[j], j));
                        }
                    }
                }

                // save file, line 6; sidequests
                chunkbuffer = lines[5].split("@");
                bugSave.side_quests = [];
                for (let i = 0; i < chunkbuffer.length; i++) {
                    bugSave.side_quests.push(chunkbuffer[i].split(","));
                }

                // save file, line 7; items/inventory
                chunkbuffer = lines[6].split("@");
                bugSave.inventory = [];
                for (let i = 0; i < chunkbuffer.length; i++) {
                    bugSave.inventory[i] = [];
                    splitbuffer = chunkbuffer[i].split(",");
                    if(splitbuffer){
                        for (let j = 0; j < splitbuffer.length; j++) {
                            if(splitbuffer[j]) {
                                bugSave.inventory[i].push(this.itemFromId(splitbuffer[j], j));
                            }
                        }
                    }
                }

                // save file, line 8; badges in inventory
                chunkbuffer = lines[7].split("@");
                let medal = null;
                for (let i = 0; i < chunkbuffer.length; i++) {
                    splitbuffer = chunkbuffer[i].split(",");
                    if(splitbuffer[0]) {
                        medal = this.medalFromId(splitbuffer[0], i, false);
                        let character_id = parseInt(splitbuffer[1], 10);
                        if (character_id >= 0) {
                            bugSave.characters[character_id].medals.push(medal);
                        } else if (character_id === -1) {
                            bugSave.medals_party.push(medal);
                        } else if (character_id === -2) {
                            bugSave.medals_inventory.push(medal);
                        }
                    }
                }

                // save file, line 9; music
                chunkbuffer = lines[8].split("@");
                bugSave.music = [];
                for (let i = 0; i < chunkbuffer.length; i++) {
                    splitbuffer = chunkbuffer[i].split(",");
                    bugSave.music.push({
                        id: i,
                        song_id: splitbuffer[0],
                        bought: (splitbuffer[1] === '1') ? true : (splitbuffer[1] === '-1' ? false : null),
                    });
                }

                // save file, line 10; stat bonuses
                chunkbuffer = lines[9].split("@");
                for (let i = 0; i < chunkbuffer.length; i++) {
                    splitbuffer = chunkbuffer[i].split(",");
                    let character_id = parseInt(splitbuffer[2], 10);
                    if(character_id >= 0){
                        bugSave.characters[character_id].stat_bonuses.push({
                            type: splitbuffer[0],
                            amount: splitbuffer[1],
                        });
                    } else if(character_id === -1){
                        bugSave.party_stat_bonuses.push({
                            type: splitbuffer[0],
                            amount: splitbuffer[1],
                        });
                    }
                }

                // save file, line 11; library
                chunkbuffer = lines[10].split("@");
                bugSave.library = [];
                for (let i = 0; i < chunkbuffer.length; i++) {
                    splitbuffer = chunkbuffer[i].split(",");
                    convertbuffer = [];
                    for (let string of splitbuffer) {
                        convertbuffer.push(this.stringToBoolean(string));
                    }
                    bugSave.library.push(convertbuffer);
                }

                // save file, line 12; flags
                splitbuffer = lines[11].split(",");
                bugSave.flags = [];
                for (let string of splitbuffer) {
                    bugSave.flags.push(this.stringToBoolean(string));
                }

                // save file, line 13; flag strings
                bugSave.flag_strings = lines[12].split("|SPLIT|");

                // @TODO: flag_strings[0:12]
                splitbuffer = bugSave.flag_strings[13].split(",");
                bugSave.mystery_medals = [];
                for(let i = 0; i < splitbuffer.length; i++){
                    if(splitbuffer[i]) {
                        bugSave.mystery_medals.push(this.medalFromId(splitbuffer[i], i));
                    }
                }
                // @TODO: flag_strings[14] -- potentially a blank/redundant line?

                // save file, line 14; flag strings
                bugSave.flag_variables = lines[13].split(",");

                // save file, line 15; regional flags
                splitbuffer = lines[14].split(",");
                bugSave.regional_flags = [];
                for (let string of splitbuffer) {
                    bugSave.regional_flags.push(this.stringToBoolean(string));
                }

                // save file, line 16; crystal berries
                splitbuffer = lines[15].split(",");
                bugSave.crystal_berries = [];
                for (let string of splitbuffer) {
                    bugSave.crystal_berries.push(this.stringToBoolean(string));
                }

                // save file, line 17; extra followers
                bugSave.extra_followers = lines[16].split(",");

                // save file, line 18; enemy encounters
                chunkbuffer = lines[17].split("@");
                bugSave.enemy_encounters = [];
                for (let i = 0; i < chunkbuffer.length; i++) {
                    splitbuffer = chunkbuffer[i].split(",");
                    bugSave.enemy_encounters.push({
                        id: i,
                        seen_count: splitbuffer[0],
                        kill_count: splitbuffer[1],
                    });
                }

                return bugSave;
            },
            writeBugFile (bugSave) {
                let lines = [];

                let joinbuffer = [];
                let weldbuffer = [];
                let convertbuffer = [];

                // save file, line 1; position, mode icons, file name
                lines[0] = '';
                joinbuffer = [
                    bugSave.position.x,
                    bugSave.position.y,
                    bugSave.position.z,
                    bugSave.modes.ruigee,
                    bugSave.modes.hardest,
                    bugSave.modes.frameone,
                    bugSave.modes.morefarm,
                    bugSave.modes.mystery,
                    bugSave.modes[5],
                    bugSave.profile_name
                ];
                lines[0] = joinbuffer.join(',');

                // save file, line 2; character stats
                lines[1] = '';
                weldbuffer = [];
                for (let i = 0; i < bugSave.characters.length; i++) {
                    let character = bugSave.characters[i];
                    if(character.exists) {
                        weldbuffer.push([
                            character['trueid'],
                            character['hp'],
                            character['maxhp'],
                            character['basehp'],
                            character['atk'],
                            character['baseatvk'],
                            character['def'],
                            character['basedef']
                        ].join(','));
                    }
                }
                lines[1] = weldbuffer.join('@');

                // save file, line 3; party stats
                lines[2] = [
                    bugSave.party_stats.partylevel,
                    bugSave.party_stats.partyexp,
                    bugSave.party_stats.neededexp,
                    bugSave.party_stats.basetp,
                    bugSave.party_stats.tp,
                    bugSave.party_stats.money,
                    bugSave.party_stats.map_name,
                    bugSave.party_stats.areaid,
                    bugSave.party_stats.bp,
                    bugSave.party_stats.maxbp,
                    bugSave.party_stats.maxitems,
                    bugSave.party_stats.maxstorage,
                    bugSave.party_stats.clockhour,
                    bugSave.party_stats.clockmin,
                    bugSave.party_stats.clocksec,
                    bugSave.party_stats.save_progress_icons
                ].join(',');

                // save file, line 4; available badges
                lines[3] = '';
                weldbuffer = [];
                for (let i = 0; i < bugSave.badge_shops.length; i++) {
                    joinbuffer = [];
                    for (let j = 0; j < bugSave.badge_shops[i].length; j++) {
                        joinbuffer.push(bugSave.badge_shops[i][j].medal_id);
                    }
                    weldbuffer.push(joinbuffer.join(','));
                }
                lines[3] = weldbuffer.join('@');

                // save file, line 5; badge shops
                lines[4] = lines[3];

                // save file, line 6; sidequests
                lines[5] = '';
                weldbuffer = [];
                for (let i = 0; i < bugSave.side_quests.length; i++) {
                    joinbuffer = [];
                    for (let j = 0; j < bugSave.side_quests[i].length; j++) {
                        joinbuffer.push(bugSave.side_quests[i][j]);
                    }
                    weldbuffer.push(joinbuffer.join(','));
                }
                lines[5] = weldbuffer.join('@');

                // save file, line 7; items/inventory
                lines[6] = '';
                weldbuffer = [];
                for (let i = 0; i < bugSave.inventory.length; i++) {
                    joinbuffer = [];
                    for (let j = 0; j < bugSave.inventory[i].length; j++) {
                        joinbuffer.push(bugSave.inventory[i][j].item_id);
                    }
                    weldbuffer.push(joinbuffer.join(','));
                }
                lines[6] = weldbuffer.join('@');

                // save file, line 8; badges in inventory
                lines[7] = '';
                weldbuffer = [];
                for (let i = 0; i < bugSave.medals_inventory.length; i++) {
                    weldbuffer.push(bugSave.medals_inventory[i].medal_id+",-2");
                }
                for (let i = 0; i < bugSave.medals_party.length; i++) {
                    weldbuffer.push(bugSave.medals_party[i].medal_id+",-1");
                }
                for (let i = 0; i < bugSave.characters.length; i++) {
                    joinbuffer = [];
                    for (let j = 0; j < bugSave.characters[i].medals.length; j++) {
                        weldbuffer.push(bugSave.characters[i].medals[j].medal_id+","+bugSave.characters[i].trueid);
                    }
                }
                lines[7] = weldbuffer.join('@');

                // save file, line 9; music
                lines[8] = '';
                weldbuffer = [];
                for (let i = 0; i < bugSave.music.length; i++) {
                    let song = bugSave.music[i];
                    weldbuffer.push(
                        song.song_id+","+(song.bought ? '1' : '-1')
                    );
                }
                lines[8] = weldbuffer.join('@');

                // save file, line 10; stat bonuses
                lines[9] = '';
                weldbuffer = [];
                for (let i = 0; i < bugSave.party_stat_bonuses.length; i++) {
                    let bonus = bugSave.party_stat_bonuses[i];
                    weldbuffer.push(bonus.type+","+bonus.amount+",-1");
                }
                for (let i = 0; i < bugSave.characters.length; i++) {
                    let character = bugSave.characters[i];
                    if(character.exists){
                        for (let j = 0; j < character.stat_bonuses.length; j++) {
                            let bonus = character.stat_bonuses[j];
                            weldbuffer.push(bonus.type+","+bonus.amount+","+character.trueid);
                        }
                    }
                }
                lines[9] = weldbuffer.join('@');

                // save file, line 11; library
                lines[10] = '';
                weldbuffer = [];
                for (let i = 0; i < bugSave.library.length; i++) {
                    convertbuffer = [];
                    for (let j = 0; j < bugSave.library[i].length; j++) {
                        convertbuffer.push(this.booleanToString(bugSave.library[i][j]));
                    }
                    weldbuffer.push(convertbuffer.join(','));
                }
                lines[10] = weldbuffer.join('@');

                // save file, line 12; flags
                lines[11] = '';
                joinbuffer = [];
                for (let flag of bugSave.flags) {
                    joinbuffer.push(this.booleanToString(flag));
                }
                lines[11] = joinbuffer.join(',');

                // save file, line 13; flag strings
                lines[12] = '';
                weldbuffer = [];
                // @TODO: flag_strings[0:12]
                joinbuffer = [];
                for(let i = 0; i < bugSave.mystery_medals.length; i++){
                    joinbuffer.push(bugSave.mystery_medals[i].medal_id);
                }
                bugSave.flag_strings[13] = joinbuffer.join(',');
                // @TODO: flag_strings[14] -- potentially a blank/redundant line?
                lines[12] = bugSave.flag_strings.join("|SPLIT|");

                // save file, line 14; flag variables
                lines[13] = bugSave.flag_variables.join(',');

                // save file, line 15; regional flags
                lines[14] = '';
                joinbuffer = [];
                for (let regional_flag of bugSave.regional_flags) {
                    joinbuffer.push(this.booleanToString(regional_flag));
                }
                lines[14] = joinbuffer.join(',');

                // save file, line 16; crystal berries
                lines[15] = '';
                joinbuffer = [];
                for (let crystal_berry of bugSave.crystal_berries) {
                    joinbuffer.push(this.booleanToString(crystal_berry));
                }
                lines[15] = joinbuffer.join(',');

                // save file, line 17; extra followers
                lines[16] = bugSave.extra_followers.join(',');

                // save file, line 18; enemy encounters
                lines[17] = [];
                weldbuffer = [];
                for (let i = 0; i < bugSave.enemy_encounters.length; i++) {
                    let enemy = bugSave.enemy_encounters[i];
                    weldbuffer.push(enemy.seen_count+","+enemy.kill_count);
                }
                lines[17] = weldbuffer.join('@');
                return lines.join("\n");
            },
            medalFromId(id, index, overrideSecret) {
                // debugger;
                overrideSecret = (typeof overrideSecret !== 'undefined') ? overrideSecret : !this.spoilers;
                if(!(id in Object.keys(this.badge_data))){
                    return {
                        id: index,
                        medal_id: id,
                        secret: true,
                        name: "broken medal",
                        description: "corrupted save or an application error",
                        type: "an",
                    }
                } else {
                    return {
                        id: index,
                        medal_id: id,
                        secret: overrideSecret,
                        name: this.badge_data[id].name,
                        description: this.badge_data[id].description,
                        type: this.badge_data[id].type,
                    }
                }
            },
            itemFromId(id, index) {
                if(!(id in Object.keys(this.item_data))){
                    return {
                        id: index,
                        item_id: id,
                        name: "broken medal",
                        short_description: "desc",
                        description: "corrupted save or an application error",
                        type: "an",
                    }
                } else {
                    return {
                        id: index,
                        item_id: id,
                        name: this.item_data[id].name,
                        short_description: "desc",
                        description: this.item_data[id].description,
                        type: this.item_data[id].type,
                    }
                }
            },
            fill_prototype () {
                for (let i = 0; i < this.game_data.num_flag_strings; i++) {
                    if(!this.proto_bug_save.flag_strings[i]){
                        this.proto_bug_save.flag_strings[i] = "";
                    }
                }
                for (let i = 0; i < this.game_data.num_flag_variables; i++) {
                    if(i in this.game_data.initial_flag_variables){
                        this.proto_bug_save.flag_variables[i] = this.game_data.initial_flag_variables[i].toString();
                    } else {
                        this.proto_bug_save.flag_variables[i] = "0";
                    }
                }
                for (let i = 0; i < this.game_data.num_flags; i++) {
                    this.proto_bug_save.flags[i] = this.game_data.initial_flags.includes(i);
                }
                for (let i = 0; i < this.game_data.num_regional_flags; i++) {
                    this.proto_bug_save.regional_flags[i] = false;
                }
                for (let i = 0; i < this.game_data.num_crystal_berries; i++) {
                    this.proto_bug_save.crystal_berries[i] = false;
                }
                for (let i = 0; i < this.game_data.num_crystal_berries; i++) {
                    this.proto_bug_save.crystal_berries[i] = false;
                }
                for (let i = 0; i < this.game_data.num_enemy_encounters; i++) {
                    if(i in this.game_data.initial_enemy_encounters){
                        this.proto_bug_save.enemy_encounters[i] = this.game_data.initial_enemy_encounters[i];
                    } else {
                        this.proto_bug_save.enemy_encounters[i] = {
                            id: i,
                            seen_count: "0",
                            kill_count: "0"
                        };
                    }
                }
                for (let i = 0; i < this.game_data.num_library_x; i++) {
                    this.proto_bug_save.library[i] = [];
                    for (let j = 0; j < this.game_data.num_library_y; j++) {
                        this.proto_bug_save.library[i][j] = false;
                    }
                }
                for (let i = 0; i < this.proto_bug_save.available_badge_pools.length; i++) {
                    this.proto_bug_save.badge_shops[i] = [];
                    for (let j = 0; j < this.proto_bug_save.available_badge_pools[i].length; j++) {
                        this.proto_bug_save.badge_shops[i][j] = this.medalFromId(this.proto_bug_save.available_badge_pools[i][j], j, false);
                    }
                }
            },
            reseed () {
                this.seed = new Date().getTime();
                this.generate_from_seed();
            },
            reset () {
                this.file_name = 'save2.dat';
                this.bug_save = JSON.parse(JSON.stringify(this.proto_bug_save));
                this.seed = new Date().getTime();
                this.bug_save.profile_name = this.seed;
                this.bug_save.flag_strings[10] = this.seed;
                this.generate_from_seed();
            },
            save () {
                let bugData = this.writeBugFile(this.bug_save);
                bugData = this.Encrypt(bugData);
                this.saveAndDownload(bugData, this.file_name, 'application/x-binary');
            },
            async dropHandler (ev) {
                // Prevent default behavior (Prevent file from being opened)
                ev.preventDefault();
                if (ev.dataTransfer.items) {
                    // Use DataTransferItemList interface to access the file(s)
                    for (let i = 0; i < ev.dataTransfer.items.length; i++) {
                        // If dropped items aren't files, reject them
                        if (ev.dataTransfer.items[i].kind === 'file') {
                            let file = ev.dataTransfer.items[i].getAsFile();
                            this.file_name = file.name;
                            console.log('loading "' + file.name + '" for use');
                            this.bug_save = this.parseBugFile(this.Encrypt(await file.text()));
                        }
                    }
                } else {
                    // Use DataTransfer interface to access the file(s)
                    for (let i = 0; i < ev.dataTransfer.files.length; i++) {
                        console.log('... file[' + i + '].name = ' + ev.dataTransfer.files[i].name);
                    }
                }
                return new Promise(function(){ return true; });
            }
        },
    })
</script>
</body>
</html>